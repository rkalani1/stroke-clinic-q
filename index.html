<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stroke Clinic Pre-Visit Questionnaire</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@600;700&family=Source+Sans+3:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --ink: #1f2a2e;
            --muted: #5f6d72;
            --accent: #0f6b6b;
            --accent-strong: #0b5151;
            --accent-warm: #d18450;
            --accent-soft: rgba(15, 107, 107, 0.14);
            --bg: #f6f1e8;
            --panel: #ffffff;
            --panel-alt: #fdfaf4;
            --outline: #e3ddd1;
            --shadow: 0 20px 45px rgba(15, 61, 62, 0.12);
            --radius: 18px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Source Sans 3", sans-serif;
            color: var(--ink);
            background:
                radial-gradient(circle at 10% 20%, rgba(209, 132, 80, 0.18), transparent 40%),
                radial-gradient(circle at 85% 5%, rgba(15, 107, 107, 0.14), transparent 45%),
                linear-gradient(120deg, #f6f1e8 0%, #eef4f3 100%);
            min-height: 100vh;
            line-height: 1.6;
        }

        .page {
            min-height: 100vh;
        }

        .hero {
            position: relative;
            padding: 64px 20px 92px;
            color: #f9fbfb;
            background: linear-gradient(120deg, #0f6b6b 0%, #0d5660 45%, #2c5d72 100%);
            overflow: hidden;
        }

        .hero::after {
            content: "";
            position: absolute;
            inset: 0;
            background:
                radial-gradient(circle at 15% 30%, rgba(255, 255, 255, 0.12), transparent 35%),
                radial-gradient(circle at 80% 10%, rgba(255, 255, 255, 0.1), transparent 45%);
            opacity: 0.8;
            pointer-events: none;
        }

        .hero-inner {
            position: relative;
            max-width: 1100px;
            margin: 0 auto;
            z-index: 1;
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .hero-tag {
            align-self: flex-start;
            text-transform: uppercase;
            letter-spacing: 0.18em;
            font-size: 0.7rem;
            padding: 6px 14px;
            border-radius: 999px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.16);
        }

        .hero h1 {
            font-family: "Fraunces", serif;
            font-size: clamp(2.1rem, 3.5vw, 3.4rem);
            line-height: 1.08;
        }

        .hero p {
            max-width: 640px;
            font-size: 1.05rem;
            color: rgba(255, 255, 255, 0.9);
        }

        .hero-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 4px;
        }

        .hero-chip {
            padding: 8px 14px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.18);
            border: 1px solid rgba(255, 255, 255, 0.25);
            font-size: 0.85rem;
        }

        .container {
            max-width: 1100px;
            margin: -46px auto 60px;
            padding: 0 20px 40px;
            position: relative;
            z-index: 2;
        }

        .notice {
            background: var(--panel);
            border: 1px solid var(--outline);
            border-radius: 14px;
            padding: 16px 18px;
            box-shadow: 0 12px 30px rgba(15, 61, 62, 0.08);
            margin-bottom: 22px;
            font-size: 0.95rem;
        }

        .notice strong {
            color: var(--accent-strong);
        }

        .layout {
            display: grid;
            gap: 24px;
        }

        @media (min-width: 980px) {
            .layout {
                grid-template-columns: minmax(0, 1fr) 340px;
                align-items: start;
            }
        }

        .card {
            background: var(--panel);
            border: 1px solid var(--outline);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .form-stack {
            display: grid;
            gap: 22px;
            counter-reset: step;
        }

        .section {
            padding: 24px;
            opacity: 0;
            transform: translateY(14px);
            animation: rise 0.6s ease forwards;
            animation-delay: var(--delay, 0ms);
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-family: "Fraunces", serif;
            font-size: 1.25rem;
            margin-bottom: 18px;
        }

        .section-title::before {
            counter-increment: step;
            content: counter(step, decimal-leading-zero);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--accent-soft);
            color: var(--accent);
            font-size: 0.85rem;
            font-weight: 700;
            letter-spacing: 0.1em;
        }

        @keyframes rise {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form-group {
            margin-bottom: 18px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 16px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--ink);
        }

        input[type="text"],
        input[type="number"],
        input[type="date"],
        textarea,
        select {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid var(--outline);
            border-radius: 12px;
            font-size: 1rem;
            background: #fff;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        input[type="date"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-soft);
        }

        textarea {
            resize: vertical;
            min-height: 120px;
            font-family: inherit;
        }

        .helper-text {
            font-size: 0.9rem;
            color: var(--muted);
            margin-top: 6px;
        }

        .medication-entry {
            display: grid;
            grid-template-columns: minmax(0, 1fr) auto;
            gap: 10px;
            margin-bottom: 12px;
            align-items: start;
        }

        .medication-input {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 10px;
        }

        .btn {
            padding: 12px 20px;
            border: 1px solid transparent;
            border-radius: 999px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s, background 0.2s;
        }

        .btn-primary {
            background: var(--accent);
            color: #fff;
            box-shadow: 0 12px 20px rgba(15, 107, 107, 0.25);
        }

        .btn-primary:hover {
            background: var(--accent-strong);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--accent-warm);
            color: #fff;
        }

        .btn-secondary:hover {
            background: #bf723e;
        }

        .btn-ghost {
            background: transparent;
            border-color: var(--outline);
            color: var(--ink);
        }

        .btn-ghost:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .btn-small {
            padding: 8px 14px;
            font-size: 0.9rem;
        }

        .btn-remove {
            background: #c84c39;
            color: #fff;
            align-self: stretch;
        }

        .btn-remove:hover {
            background: #a63d2e;
        }

        .bp-inputs {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 16px;
        }

        .bp-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .bp-row {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 10px;
            align-items: center;
        }

        .bp-separator {
            color: var(--muted);
            font-weight: 600;
        }

        .radio-group {
            display: inline-flex;
            gap: 8px;
            padding: 6px;
            border-radius: 999px;
            background: var(--panel-alt);
            border: 1px solid var(--outline);
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .radio-option {
            position: relative;
        }

        .radio-option input {
            position: absolute;
            opacity: 0;
            pointer-events: none;
        }

        .radio-option label {
            margin: 0;
            padding: 8px 16px;
            border-radius: 999px;
            font-weight: 600;
            color: var(--muted);
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
        }

        .radio-option input:checked + label {
            background: var(--accent);
            color: #fff;
        }

        .radio-option input:focus-visible + label {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
        }

        .conditional-fields {
            margin-top: 12px;
            padding: 0 14px;
            border-left: 3px solid var(--accent-soft);
            background: var(--panel-alt);
            border-radius: 12px;
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            transition: max-height 0.3s ease, opacity 0.3s ease, padding 0.3s ease;
        }

        .conditional-fields.active {
            padding: 14px;
            max-height: 400px;
            opacity: 1;
        }

        .checkbox-group {
            display: grid;
            gap: 12px;
        }

        .checkbox-option {
            display: flex;
            gap: 12px;
            align-items: flex-start;
            padding: 12px;
            border-radius: 12px;
            border: 1px solid var(--outline);
            background: #fff;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .checkbox-option:hover,
        .checkbox-option:focus-within {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-soft);
        }

        .checkbox-option input {
            margin-top: 2px;
            width: 20px;
            height: 20px;
            accent-color: var(--accent);
        }

        .submit-card {
            padding: 24px;
            text-align: center;
            border-style: dashed;
            background: var(--panel-alt);
        }

        .submit-card p {
            color: var(--muted);
            margin-bottom: 16px;
        }

        .result-container {
            padding: 20px;
            position: sticky;
            top: 24px;
            display: grid;
            gap: 16px;
        }

        .result-empty {
            text-align: center;
            color: var(--muted);
        }

        .result-empty p {
            margin-top: 8px;
        }

        .result-title {
            font-family: "Fraunces", serif;
            font-size: 1.3rem;
        }

        .result-note {
            color: var(--muted);
            font-size: 0.9rem;
        }

        .result-content {
            background: #fbfaf6;
            border: 1px dashed var(--outline);
            border-radius: 12px;
            padding: 16px;
            white-space: pre-wrap;
            font-size: 0.95rem;
            line-height: 1.6;
            max-height: 420px;
            overflow-y: auto;
        }

        .result-actions {
            display: grid;
            gap: 10px;
        }

        .result-actions .btn {
            width: 100%;
        }

        .result-container:not(.active) .result-body {
            display: none;
        }

        .result-container.active .result-empty {
            display: none;
        }

        .pack-years-display {
            margin-top: 10px;
            padding: 10px 12px;
            background: rgba(15, 107, 107, 0.1);
            border-radius: 12px;
            font-weight: 600;
            color: var(--accent-strong);
        }

        @media (max-width: 900px) {
            .container {
                margin-top: -36px;
            }

            .result-container {
                position: static;
            }
        }

        @media (max-width: 700px) {
            .form-row,
            .medication-input,
            .bp-inputs {
                grid-template-columns: 1fr;
            }

            .hero {
                padding: 54px 18px 76px;
            }
        }

        @media (prefers-reduced-motion: reduce) {
            .section {
                opacity: 1;
                transform: none;
                animation: none;
            }
        }
    </style>
</head>
<body>
    <div class="page">
        <header class="hero">
            <div class="hero-inner">
                <span class="hero-tag">UW Medicine / Harborview Medical Center</span>
                <h1>Stroke Clinic Pre-Visit Questionnaire</h1>
                <p>Fill in the details below and generate a MyChart-ready message you can copy and paste.</p>
                <div class="hero-meta">
                    <span class="hero-chip">All data stays on this device</span>
                    <span class="hero-chip">Estimated time: 5 to 7 minutes</span>
                </div>
            </div>
        </header>

        <main class="container">
            <div class="notice">
                <strong>Privacy note:</strong> This form runs entirely in your browser. Nothing is stored or sent anywhere.
            </div>

            <div class="layout">
                <form id="questionnaireForm" class="form-stack">
                    <section class="section card" style="--delay: 0ms;">
                        <h2 class="section-title">Patient details</h2>
                        <div class="form-group">
                            <label for="patientName">Patient full name (optional)</label>
                            <input type="text" id="patientName" placeholder="Jane Doe">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="patientDob">Date of birth (optional)</label>
                                <input type="date" id="patientDob">
                            </div>
                            <div class="form-group">
                                <label for="appointmentDate">Appointment date (optional)</label>
                                <input type="date" id="appointmentDate">
                            </div>
                        </div>
                    </section>

                    <section class="section card" style="--delay: 60ms;">
                        <h2 class="section-title">Primary care information</h2>
                        <div class="form-group">
                            <label for="pcpName">Primary care doctor name</label>
                            <input type="text" id="pcpName" placeholder="Dr. Jane Smith">
                        </div>
                    </section>

                    <section class="section card" style="--delay: 120ms;">
                        <h2 class="section-title">Current medications and supplements</h2>
                        <div id="medicationsContainer">
                            <div class="medication-entry">
                                <div class="medication-input">
                                    <input type="text" class="med-name" placeholder="Medication name (e.g., atorvastatin)">
                                    <input type="text" class="med-dose" placeholder="Dose (e.g., 40 mg daily)">
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-secondary btn-small" onclick="addMedication()">+ Add another medication</button>
                    </section>

                    <section class="section card" style="--delay: 180ms;">
                        <h2 class="section-title">Home blood pressure (past week)</h2>
                        <div class="bp-inputs">
                            <div class="bp-group">
                                <label>Systolic (top number)</label>
                                <div class="bp-row">
                                    <input type="number" id="bpSystolicMin" placeholder="Min" min="60" max="250">
                                    <span class="bp-separator">to</span>
                                    <input type="number" id="bpSystolicMax" placeholder="Max" min="60" max="250">
                                </div>
                            </div>
                            <div class="bp-group">
                                <label>Diastolic (bottom number)</label>
                                <div class="bp-row">
                                    <input type="number" id="bpDiastolicMin" placeholder="Min" min="40" max="150">
                                    <span class="bp-separator">to</span>
                                    <input type="number" id="bpDiastolicMax" placeholder="Max" min="40" max="150">
                                </div>
                            </div>
                        </div>
                        <p class="helper-text">Enter the range of your blood pressure readings over the past week.</p>
                    </section>

                    <section class="section card" style="--delay: 240ms;">
                        <h2 class="section-title">Tobacco use</h2>
                        <div class="form-group">
                            <label>Do you currently use tobacco?</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="tobaccoCurrentYes" name="tobaccoCurrent" value="yes" onchange="toggleConditional('tobaccoCurrentFields', true)">
                                    <label for="tobaccoCurrentYes">Yes</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="tobaccoCurrentNo" name="tobaccoCurrent" value="no" onchange="toggleConditional('tobaccoCurrentFields', false)">
                                    <label for="tobaccoCurrentNo">No</label>
                                </div>
                            </div>
                            <div id="tobaccoCurrentFields" class="conditional-fields">
                                <div class="form-group">
                                    <label for="tobaccoType">Type of tobacco</label>
                                    <input type="text" id="tobaccoType" placeholder="e.g., cigarettes, cigars, chewing tobacco">
                                </div>
                                <div class="form-group">
                                    <label for="tobaccoAmount">Amount per day</label>
                                    <input type="text" id="tobaccoAmount" placeholder="e.g., 1 pack, 5 cigarettes">
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Have you used tobacco in the past?</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="tobaccoPriorYes" name="tobaccoPrior" value="yes" onchange="toggleConditional('tobaccoPriorFields', true)">
                                    <label for="tobaccoPriorYes">Yes</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="tobaccoPriorNo" name="tobaccoPrior" value="no" onchange="toggleConditional('tobaccoPriorFields', false)">
                                    <label for="tobaccoPriorNo">No</label>
                                </div>
                            </div>
                            <div id="tobaccoPriorFields" class="conditional-fields">
                                <div class="form-group">
                                    <label for="tobaccoPriorYears">Total years used</label>
                                    <input type="number" id="tobaccoPriorYears" placeholder="e.g., 15" min="0" oninput="calculatePackYears()">
                                </div>
                                <div class="form-group">
                                    <label for="tobaccoPriorPacks">Packs per day (for cigarettes)</label>
                                    <input type="number" id="tobaccoPriorPacks" placeholder="e.g., 1.5" min="0" step="0.1" oninput="calculatePackYears()">
                                </div>
                                <div id="packYearsDisplay" class="pack-years-display" style="display: none;"></div>
                            </div>
                        </div>
                    </section>

                    <section class="section card" style="--delay: 300ms;">
                        <h2 class="section-title">Alcohol use</h2>
                        <div class="form-group">
                            <label>Do you currently use alcohol?</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="alcoholCurrentYes" name="alcoholCurrent" value="yes" onchange="toggleConditional('alcoholCurrentFields', true)">
                                    <label for="alcoholCurrentYes">Yes</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="alcoholCurrentNo" name="alcoholCurrent" value="no" onchange="toggleConditional('alcoholCurrentFields', false)">
                                    <label for="alcoholCurrentNo">No</label>
                                </div>
                            </div>
                            <div id="alcoholCurrentFields" class="conditional-fields">
                                <div class="form-group">
                                    <label for="alcoholType">Type of alcohol</label>
                                    <input type="text" id="alcoholType" placeholder="e.g., beer, wine, liquor">
                                </div>
                                <div class="form-group">
                                    <label for="alcoholDrinks">Average drinks per week</label>
                                    <input type="number" id="alcoholDrinks" placeholder="e.g., 5" min="0">
                                </div>
                                <div class="form-group">
                                    <label for="alcoholYears">Years of use</label>
                                    <input type="number" id="alcoholYears" placeholder="e.g., 10" min="0">
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Have you used alcohol in the past?</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="alcoholPriorYes" name="alcoholPrior" value="yes" onchange="toggleConditional('alcoholPriorFields', true)">
                                    <label for="alcoholPriorYes">Yes</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="alcoholPriorNo" name="alcoholPrior" value="no" onchange="toggleConditional('alcoholPriorFields', false)">
                                    <label for="alcoholPriorNo">No</label>
                                </div>
                            </div>
                            <div id="alcoholPriorFields" class="conditional-fields">
                                <div class="form-group">
                                    <label for="alcoholPriorType">Type of alcohol</label>
                                    <input type="text" id="alcoholPriorType" placeholder="e.g., beer, wine, liquor">
                                </div>
                                <div class="form-group">
                                    <label for="alcoholPriorDuration">Duration and amount</label>
                                    <input type="text" id="alcoholPriorDuration" placeholder="e.g., 15 years, ~10 drinks/week">
                                </div>
                            </div>
                        </div>
                    </section>

                    <section class="section card" style="--delay: 360ms;">
                        <h2 class="section-title">Illicit drug use and exposure</h2>
                        <div class="form-group">
                            <label>Do you currently use illicit drugs?</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="drugCurrentYes" name="drugCurrent" value="yes" onchange="toggleConditional('drugCurrentFields', true)">
                                    <label for="drugCurrentYes">Yes</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="drugCurrentNo" name="drugCurrent" value="no" onchange="toggleConditional('drugCurrentFields', false)">
                                    <label for="drugCurrentNo">No</label>
                                </div>
                            </div>
                            <div id="drugCurrentFields" class="conditional-fields">
                                <div class="form-group">
                                    <label for="drugCurrentType">Specify drug(s)</label>
                                    <input type="text" id="drugCurrentType" placeholder="e.g., marijuana, cocaine">
                                </div>
                                <div class="form-group">
                                    <label for="drugCurrentFreq">Frequency</label>
                                    <input type="text" id="drugCurrentFreq" placeholder="e.g., daily, weekly">
                                </div>
                                <div class="form-group">
                                    <label for="drugCurrentRoute">Route of administration</label>
                                    <input type="text" id="drugCurrentRoute" placeholder="e.g., oral, inhaled, IV">
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Have you used illicit drugs in the past?</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="drugPriorYes" name="drugPrior" value="yes" onchange="toggleConditional('drugPriorFields', true)">
                                    <label for="drugPriorYes">Yes</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="drugPriorNo" name="drugPrior" value="no" onchange="toggleConditional('drugPriorFields', false)">
                                    <label for="drugPriorNo">No</label>
                                </div>
                            </div>
                            <div id="drugPriorFields" class="conditional-fields">
                                <div class="form-group">
                                    <label for="drugPriorType">Specify drug(s)</label>
                                    <input type="text" id="drugPriorType" placeholder="e.g., marijuana, cocaine">
                                </div>
                                <div class="form-group">
                                    <label for="drugPriorDuration">Duration</label>
                                    <input type="text" id="drugPriorDuration" placeholder="e.g., 5 years, stopped 2010">
                                </div>
                                <div class="form-group">
                                    <label for="drugPriorRoute">Route of administration</label>
                                    <input type="text" id="drugPriorRoute" placeholder="e.g., oral, inhaled, IV">
                                </div>
                            </div>
                        </div>
                    </section>

                    <section class="section card" style="--delay: 420ms;">
                        <h2 class="section-title">STOP-BANG questionnaire (sleep apnea screening)</h2>
                        <p class="helper-text" style="margin-bottom: 15px;">Please answer the following questions.</p>
                        <div class="checkbox-group">
                            <div class="checkbox-option">
                                <input type="checkbox" id="sb1" name="stopbang" value="Snoring">
                                <label for="sb1">Do you snore loudly (louder than talking or loud enough to be heard through closed doors)?</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="sb2" name="stopbang" value="Tired">
                                <label for="sb2">Do you often feel tired, fatigued, or sleepy during the daytime?</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="sb3" name="stopbang" value="Observed">
                                <label for="sb3">Has anyone observed you stop breathing during your sleep?</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="sb4" name="stopbang" value="Pressure">
                                <label for="sb4">Do you have or are you being treated for high blood pressure?</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="sb5" name="stopbang" value="BMI">
                                <label for="sb5">Is your BMI greater than 35 kg/m2?</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="sb6" name="stopbang" value="Age">
                                <label for="sb6">Are you over 50 years old?</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="sb7" name="stopbang" value="Neck">
                                <label for="sb7">Is your neck circumference greater than 40 cm (about 16 inches)?</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="sb8" name="stopbang" value="Male">
                                <label for="sb8">Are you male?</label>
                            </div>
                        </div>
                    </section>

                    <section class="section card" style="--delay: 480ms;">
                        <h2 class="section-title">Questions for your visit</h2>
                        <div class="form-group">
                            <label for="patientQuestions">What are the most important questions you want answered during your visit?</label>
                            <textarea id="patientQuestions" rows="6" placeholder="Please list your questions here..."></textarea>
                        </div>
                    </section>

                    <div class="section card submit-card" style="--delay: 540ms;">
                        <p>When you are ready, generate a summary you can paste directly into MyChart.</p>
                        <button type="button" class="btn btn-primary" onclick="generateSummary()">Generate MyChart Summary</button>
                    </div>
                </form>

                <aside id="resultContainer" class="card result-container">
                    <div class="result-empty">
                        <h3 class="result-title">MyChart message</h3>
                        <p>Generate a summary to preview and copy your message.</p>
                    </div>
                    <div class="result-body">
                        <h3 class="result-title">MyChart message ready to copy</h3>
                        <p class="result-note">Copy and paste this into an Epic MyChart message.</p>
                        <div id="resultContent" class="result-content" aria-live="polite"></div>
                        <div class="result-actions">
                            <button class="btn btn-primary" type="button" onclick="copyToClipboard(event)">Copy message</button>
                            <button class="btn btn-ghost" type="button" onclick="downloadPDF()">Download PDF</button>
                            <button class="btn btn-ghost" type="button" onclick="resetForm()">Start over</button>
                        </div>
                    </div>
                </aside>
            </div>
        </main>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        function addMedication() {
            const container = document.getElementById('medicationsContainer');
            const newEntry = document.createElement('div');
            newEntry.className = 'medication-entry';
            newEntry.innerHTML = `
                <div class="medication-input">
                    <input type="text" class="med-name" placeholder="Medication name">
                    <input type="text" class="med-dose" placeholder="Dose">
                </div>
                <button type="button" class="btn btn-remove btn-small" onclick="this.parentElement.remove()">Remove</button>
            `;
            container.appendChild(newEntry);
        }

        function toggleConditional(fieldId, show) {
            const field = document.getElementById(fieldId);
            if (show) {
                field.classList.add('active');
            } else {
                field.classList.remove('active');
            }
        }

        function calculatePackYears() {
            const years = parseFloat(document.getElementById('tobaccoPriorYears').value) || 0;
            const packs = parseFloat(document.getElementById('tobaccoPriorPacks').value) || 0;
            const packYears = years * packs;

            const display = document.getElementById('packYearsDisplay');
            if (packYears > 0) {
                display.style.display = 'block';
                display.textContent = `Estimated pack-years: ${packYears.toFixed(1)}`;
            } else {
                display.style.display = 'none';
            }
        }

        function formatDate(value) {
            if (!value) {
                return '';
            }
            const parts = value.split('-');
            if (parts.length !== 3) {
                return value;
            }
            return `${parts[1]}/${parts[2]}/${parts[0]}`;
        }

        function buildTobaccoSummary() {
            const tobaccoCurrent = document.querySelector('input[name="tobaccoCurrent"]:checked')?.value;
            const tobaccoPrior = document.querySelector('input[name="tobaccoPrior"]:checked')?.value;

            if (tobaccoCurrent === 'yes') {
                const type = document.getElementById('tobaccoType').value.trim();
                const amount = document.getElementById('tobaccoAmount').value.trim();
                let summary = 'Current use';
                if (type) summary += `, ${type}`;
                if (amount) summary += `, ${amount}`;
                return summary;
            }

            if (tobaccoPrior === 'yes') {
                const years = document.getElementById('tobaccoPriorYears').value;
                const packs = document.getElementById('tobaccoPriorPacks').value;
                const packYears = years && packs ? (parseFloat(years) * parseFloat(packs)).toFixed(1) : null;
                let summary = 'Former use';
                if (packYears) summary += `, ${packYears} pack-years`;
                return summary;
            }

            if (tobaccoCurrent === 'no' && tobaccoPrior === 'no') {
                return 'No';
            }

            if (tobaccoCurrent === 'no' && !tobaccoPrior) {
                return 'No current use';
            }

            if (!tobaccoCurrent && tobaccoPrior === 'no') {
                return 'No';
            }

            return 'Not provided';
        }

        function buildAlcoholSummary() {
            const alcoholCurrent = document.querySelector('input[name="alcoholCurrent"]:checked')?.value;
            const alcoholPrior = document.querySelector('input[name="alcoholPrior"]:checked')?.value;

            if (alcoholCurrent === 'yes') {
                const type = document.getElementById('alcoholType').value.trim();
                const drinks = document.getElementById('alcoholDrinks').value;
                const years = document.getElementById('alcoholYears').value;
                let summary = 'Current use';
                if (type) summary += `, ${type}`;
                if (drinks) summary += `, ${drinks} drinks/week`;
                if (years) summary += `, ${years} years`;
                return summary;
            }

            if (alcoholPrior === 'yes') {
                const type = document.getElementById('alcoholPriorType').value.trim();
                const duration = document.getElementById('alcoholPriorDuration').value.trim();
                let summary = 'Former use';
                if (type) summary += `, ${type}`;
                if (duration) summary += `, ${duration}`;
                return summary;
            }

            if (alcoholCurrent === 'no' && alcoholPrior === 'no') {
                return 'No';
            }

            if (alcoholCurrent === 'no' && !alcoholPrior) {
                return 'No current use';
            }

            if (!alcoholCurrent && alcoholPrior === 'no') {
                return 'No';
            }

            return 'Not provided';
        }

        function buildDrugSummary() {
            const drugCurrent = document.querySelector('input[name="drugCurrent"]:checked')?.value;
            const drugPrior = document.querySelector('input[name="drugPrior"]:checked')?.value;

            if (drugCurrent === 'yes') {
                const type = document.getElementById('drugCurrentType').value.trim();
                const freq = document.getElementById('drugCurrentFreq').value.trim();
                const route = document.getElementById('drugCurrentRoute').value.trim();
                let summary = 'Current use';
                if (type) summary += `, ${type}`;
                if (freq) summary += `, ${freq}`;
                if (route) summary += `, ${route}`;
                return summary;
            }

            if (drugPrior === 'yes') {
                const type = document.getElementById('drugPriorType').value.trim();
                const duration = document.getElementById('drugPriorDuration').value.trim();
                const route = document.getElementById('drugPriorRoute').value.trim();
                let summary = 'Former use';
                if (type) summary += `, ${type}`;
                if (duration) summary += `, ${duration}`;
                if (route) summary += `, ${route}`;
                return summary;
            }

            if (drugCurrent === 'no' && drugPrior === 'no') {
                return 'No';
            }

            if (drugCurrent === 'no' && !drugPrior) {
                return 'No current use';
            }

            if (!drugCurrent && drugPrior === 'no') {
                return 'No';
            }

            return 'Not provided';
        }

        function generateSummary() {
            const lines = [];
            const patientName = document.getElementById('patientName').value.trim();
            const patientDob = formatDate(document.getElementById('patientDob').value);
            const appointmentDate = formatDate(document.getElementById('appointmentDate').value);

            lines.push('Subject: Stroke Clinic Pre-Visit Questionnaire');
            lines.push('');
            lines.push('Hello Stroke Clinic team,');
            lines.push('');
            lines.push('Here is my pre-visit questionnaire information:');
            lines.push('');

            if (patientName || patientDob || appointmentDate) {
                lines.push('Patient details:');
                if (patientName) lines.push(`- Name: ${patientName}`);
                if (patientDob) lines.push(`- Date of birth: ${patientDob}`);
                if (appointmentDate) lines.push(`- Appointment date: ${appointmentDate}`);
                lines.push('');
            }

            const pcp = document.getElementById('pcpName').value.trim();
            lines.push(`Primary care doctor: ${pcp || 'None'}`);
            lines.push('');

            const medEntries = document.querySelectorAll('.medication-entry');
            const meds = [];
            medEntries.forEach(entry => {
                const name = entry.querySelector('.med-name').value.trim();
                const dose = entry.querySelector('.med-dose').value.trim();
                if (name && dose) {
                    meds.push(`${name} ${dose}`);
                } else if (name) {
                    meds.push(name);
                }
            });

            lines.push('Current medications and supplements:');
            if (meds.length > 0) {
                meds.forEach(item => lines.push(`- ${item}`));
            } else {
                lines.push('- None');
            }
            lines.push('');

            const bpSysMin = document.getElementById('bpSystolicMin').value;
            const bpSysMax = document.getElementById('bpSystolicMax').value;
            const bpDiaMin = document.getElementById('bpDiastolicMin').value;
            const bpDiaMax = document.getElementById('bpDiastolicMax').value;

            let bpLine = 'Home blood pressure (past week): ';
            if (bpSysMin && bpSysMax && bpDiaMin && bpDiaMax) {
                bpLine += `${bpSysMin}-${bpSysMax} / ${bpDiaMin}-${bpDiaMax} mmHg`;
            } else if (bpSysMin && bpDiaMin) {
                bpLine += `${bpSysMin} / ${bpDiaMin} mmHg`;
            } else {
                bpLine += 'Not provided';
            }
            lines.push(bpLine);
            lines.push('');

            lines.push(`Tobacco use: ${buildTobaccoSummary()}`);
            lines.push(`Alcohol use: ${buildAlcoholSummary()}`);
            lines.push(`Illicit drug use: ${buildDrugSummary()}`);
            lines.push('');

            const stopbangChecked = document.querySelectorAll('input[name="stopbang"]:checked');
            const stopbangItems = Array.from(stopbangChecked).map(cb => cb.value);
            const stopbangScore = stopbangItems.length;
            let osaLine = `OSA screen (STOP-BANG): ${stopbangScore}/8`;
            if (stopbangScore > 0) {
                osaLine += ` (Yes: ${stopbangItems.join(', ')})`;
            }
            lines.push(osaLine);
            lines.push('');

            const questions = document.getElementById('patientQuestions').value.trim();
            lines.push('Questions for provider:');
            lines.push(questions || 'None');

            if (patientName) {
                lines.push('');
                lines.push('Thank you,');
                lines.push(patientName);
            }

            const summary = lines.join('\n');
            const resultContainer = document.getElementById('resultContainer');
            document.getElementById('resultContent').textContent = summary;
            resultContainer.classList.add('active');
            resultContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function copyToClipboard(event) {
            const content = document.getElementById('resultContent').textContent;
            if (!content.trim()) {
                alert('Please generate a summary first.');
                return;
            }
            navigator.clipboard.writeText(content).then(() => {
                const btn = event?.target;
                if (!btn) {
                    return;
                }
                const originalText = btn.textContent;
                btn.textContent = 'Copied!';
                btn.style.background = '#1a7f5a';
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '';
                }, 2000);
            }).catch(() => {
                alert('Failed to copy to clipboard. Please copy manually.');
            });
        }

        function downloadPDF() {
            const content = document.getElementById('resultContent').textContent;
            if (!content.trim()) {
                alert('Please generate a summary first.');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            doc.setFontSize(16);
            doc.setTextColor(15, 107, 107);
            doc.text('Stroke Clinic Pre-Visit Questionnaire', 20, 20);
            doc.setFontSize(11);
            doc.text('UW Medicine / Harborview Medical Center', 20, 28);

            doc.setFontSize(10);
            doc.setTextColor(0, 0, 0);
            const lines = doc.splitTextToSize(content, 170);
            doc.text(lines, 20, 40);

            const date = new Date().toLocaleDateString();
            doc.setFontSize(8);
            doc.setTextColor(100, 100, 100);
            doc.text(`Generated: ${date}`, 20, 280);

            doc.save('stroke-clinic-pre-visit-questionnaire.pdf');
        }

        function resetForm() {
            document.getElementById('questionnaireForm').reset();
            document.getElementById('resultContainer').classList.remove('active');
            document.querySelectorAll('.conditional-fields').forEach(field => {
                field.classList.remove('active');
            });
            document.getElementById('packYearsDisplay').style.display = 'none';

            const container = document.getElementById('medicationsContainer');
            const entries = container.querySelectorAll('.medication-entry');
            for (let i = 1; i < entries.length; i++) {
                entries[i].remove();
            }

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>
