<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pre-Visit Questionnaire - UW Medicine</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #4b2e83 0%, #85754d 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: #4b2e83;
            color: white;
            padding: 30px 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .content {
            padding: 30px 20px;
        }

        .section {
            margin-bottom: 35px;
            padding-bottom: 25px;
            border-bottom: 1px solid #e0e0e0;
        }

        .section:last-child {
            border-bottom: none;
        }

        .section-title {
            color: #4b2e83;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .section-title::before {
            content: '';
            display: inline-block;
            width: 4px;
            height: 24px;
            background: #85754d;
            margin-right: 12px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }

        input[type="text"],
        input[type="number"],
        textarea,
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #4b2e83;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
        }

        .medication-entry {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 10px;
            margin-bottom: 10px;
            align-items: start;
        }

        .medication-input {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #4b2e83;
            color: white;
        }

        .btn-primary:hover {
            background: #3a2366;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(75, 46, 131, 0.3);
        }

        .btn-secondary {
            background: #85754d;
            color: white;
        }

        .btn-secondary:hover {
            background: #6e6140;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
        }

        .btn-remove {
            background: #dc3545;
            color: white;
            padding: 8px 12px;
            font-size: 14px;
        }

        .btn-remove:hover {
            background: #c82333;
        }

        .bp-inputs {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .bp-group {
            display: flex;
            flex-direction: column;
        }

        .bp-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .bp-row input {
            flex: 1;
        }

        .bp-separator {
            color: #666;
            font-weight: bold;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        input[type="radio"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .conditional-fields {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            display: none;
        }

        .conditional-fields.active {
            display: block;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .checkbox-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .checkbox-option:hover {
            border-color: #4b2e83;
            background: #f8f9fa;
        }

        .checkbox-option input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .submit-section {
            margin-top: 30px;
            text-align: center;
        }

        .result-container {
            display: none;
            margin-top: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px solid #4b2e83;
        }

        .result-container.active {
            display: block;
        }

        .result-title {
            color: #4b2e83;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .result-content {
            background: white;
            padding: 20px;
            border-radius: 6px;
            font-family: monospace;
            white-space: pre-wrap;
            font-size: 14px;
            line-height: 1.8;
            margin-bottom: 15px;
            max-height: 400px;
            overflow-y: auto;
        }

        .result-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .pack-years-display {
            margin-top: 10px;
            padding: 10px;
            background: #e8f4f8;
            border-radius: 6px;
            font-weight: 600;
            color: #4b2e83;
        }

        .info-text {
            font-size: 13px;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }

        @media (max-width: 600px) {
            body {
                padding: 10px;
            }

            .content {
                padding: 20px 15px;
            }

            .medication-input {
                grid-template-columns: 1fr;
            }

            .bp-inputs {
                grid-template-columns: 1fr;
            }

            .result-actions {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }

        .privacy-notice {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 25px;
            font-size: 14px;
        }

        .privacy-notice strong {
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Pre-Visit Questionnaire</h1>
            <p>UW Medicine / Harborview Medical Center - Stroke Clinic</p>
        </div>

        <div class="content">
            <div class="privacy-notice">
                <strong>Privacy Notice:</strong> Your responses are processed entirely in your browser. No data is stored on any server or transmitted elsewhere.
            </div>

            <form id="questionnaireForm">
                <!-- Primary Care Doctor -->
                <div class="section">
                    <h2 class="section-title">Primary Care Information</h2>
                    <div class="form-group">
                        <label for="pcpName">Primary Care Doctor Name</label>
                        <input type="text" id="pcpName" placeholder="Dr. Jane Smith">
                    </div>
                </div>

                <!-- Medications -->
                <div class="section">
                    <h2 class="section-title">Current Medications & Supplements</h2>
                    <div id="medicationsContainer">
                        <div class="medication-entry">
                            <div class="medication-input">
                                <input type="text" class="med-name" placeholder="Medication name (e.g., atorvastatin)">
                                <input type="text" class="med-dose" placeholder="Dose (e.g., 40 mg daily)">
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-secondary btn-small" onclick="addMedication()">+ Add Another Medication</button>
                </div>

                <!-- Blood Pressure -->
                <div class="section">
                    <h2 class="section-title">Home Blood Pressure (Past Week)</h2>
                    <div class="bp-inputs">
                        <div class="bp-group">
                            <label>Systolic (Top Number)</label>
                            <div class="bp-row">
                                <input type="number" id="bpSystolicMin" placeholder="Min" min="60" max="250">
                                <span class="bp-separator">to</span>
                                <input type="number" id="bpSystolicMax" placeholder="Max" min="60" max="250">
                            </div>
                        </div>
                        <div class="bp-group">
                            <label>Diastolic (Bottom Number)</label>
                            <div class="bp-row">
                                <input type="number" id="bpDiastolicMin" placeholder="Min" min="40" max="150">
                                <span class="bp-separator">to</span>
                                <input type="number" id="bpDiastolicMax" placeholder="Max" min="40" max="150">
                            </div>
                        </div>
                    </div>
                    <p class="info-text">Enter the range of your blood pressure readings over the past week</p>
                </div>

                <!-- Tobacco Use -->
                <div class="section">
                    <h2 class="section-title">Tobacco Use</h2>

                    <div class="form-group">
                        <label>Do you currently use tobacco?</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="tobaccoCurrentYes" name="tobaccoCurrent" value="yes" onchange="toggleConditional('tobaccoCurrentFields', true)">
                                <label for="tobaccoCurrentYes" style="margin: 0;">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="tobaccoCurrentNo" name="tobaccoCurrent" value="no" onchange="toggleConditional('tobaccoCurrentFields', false)">
                                <label for="tobaccoCurrentNo" style="margin: 0;">No</label>
                            </div>
                        </div>
                        <div id="tobaccoCurrentFields" class="conditional-fields">
                            <div class="form-group">
                                <label for="tobaccoType">Type of tobacco</label>
                                <input type="text" id="tobaccoType" placeholder="e.g., cigarettes, cigars, chewing tobacco">
                            </div>
                            <div class="form-group">
                                <label for="tobaccoAmount">Amount per day</label>
                                <input type="text" id="tobaccoAmount" placeholder="e.g., 1 pack, 5 cigarettes">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Have you used tobacco in the past?</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="tobaccoPriorYes" name="tobaccoPrior" value="yes" onchange="toggleConditional('tobaccoPriorFields', true)">
                                <label for="tobaccoPriorYes" style="margin: 0;">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="tobaccoPriorNo" name="tobaccoPrior" value="no" onchange="toggleConditional('tobaccoPriorFields', false)">
                                <label for="tobaccoPriorNo" style="margin: 0;">No</label>
                            </div>
                        </div>
                        <div id="tobaccoPriorFields" class="conditional-fields">
                            <div class="form-group">
                                <label for="tobaccoPriorYears">Total years used</label>
                                <input type="number" id="tobaccoPriorYears" placeholder="e.g., 15" min="0" onchange="calculatePackYears()">
                            </div>
                            <div class="form-group">
                                <label for="tobaccoPriorPacks">Packs per day (for cigarettes)</label>
                                <input type="number" id="tobaccoPriorPacks" placeholder="e.g., 1.5" min="0" step="0.1" onchange="calculatePackYears()">
                            </div>
                            <div id="packYearsDisplay" class="pack-years-display" style="display: none;"></div>
                        </div>
                    </div>
                </div>

                <!-- Alcohol Use -->
                <div class="section">
                    <h2 class="section-title">Alcohol Use</h2>

                    <div class="form-group">
                        <label>Do you currently use alcohol?</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="alcoholCurrentYes" name="alcoholCurrent" value="yes" onchange="toggleConditional('alcoholCurrentFields', true)">
                                <label for="alcoholCurrentYes" style="margin: 0;">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="alcoholCurrentNo" name="alcoholCurrent" value="no" onchange="toggleConditional('alcoholCurrentFields', false)">
                                <label for="alcoholCurrentNo" style="margin: 0;">No</label>
                            </div>
                        </div>
                        <div id="alcoholCurrentFields" class="conditional-fields">
                            <div class="form-group">
                                <label for="alcoholType">Type of alcohol</label>
                                <input type="text" id="alcoholType" placeholder="e.g., beer, wine, liquor">
                            </div>
                            <div class="form-group">
                                <label for="alcoholDrinks">Average drinks per week</label>
                                <input type="number" id="alcoholDrinks" placeholder="e.g., 5" min="0">
                            </div>
                            <div class="form-group">
                                <label for="alcoholYears">Years of use</label>
                                <input type="number" id="alcoholYears" placeholder="e.g., 10" min="0">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Have you used alcohol in the past?</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="alcoholPriorYes" name="alcoholPrior" value="yes" onchange="toggleConditional('alcoholPriorFields', true)">
                                <label for="alcoholPriorYes" style="margin: 0;">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="alcoholPriorNo" name="alcoholPrior" value="no" onchange="toggleConditional('alcoholPriorFields', false)">
                                <label for="alcoholPriorNo" style="margin: 0;">No</label>
                            </div>
                        </div>
                        <div id="alcoholPriorFields" class="conditional-fields">
                            <div class="form-group">
                                <label for="alcoholPriorType">Type of alcohol</label>
                                <input type="text" id="alcoholPriorType" placeholder="e.g., beer, wine, liquor">
                            </div>
                            <div class="form-group">
                                <label for="alcoholPriorDuration">Duration and amount</label>
                                <input type="text" id="alcoholPriorDuration" placeholder="e.g., 15 years, ~10 drinks/week">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Illicit Drug Use -->
                <div class="section">
                    <h2 class="section-title">Illicit Drug Use/Exposure</h2>

                    <div class="form-group">
                        <label>Do you currently use illicit drugs?</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="drugCurrentYes" name="drugCurrent" value="yes" onchange="toggleConditional('drugCurrentFields', true)">
                                <label for="drugCurrentYes" style="margin: 0;">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="drugCurrentNo" name="drugCurrent" value="no" onchange="toggleConditional('drugCurrentFields', false)">
                                <label for="drugCurrentNo" style="margin: 0;">No</label>
                            </div>
                        </div>
                        <div id="drugCurrentFields" class="conditional-fields">
                            <div class="form-group">
                                <label for="drugCurrentType">Specify drug(s)</label>
                                <input type="text" id="drugCurrentType" placeholder="e.g., marijuana, cocaine">
                            </div>
                            <div class="form-group">
                                <label for="drugCurrentFreq">Frequency</label>
                                <input type="text" id="drugCurrentFreq" placeholder="e.g., daily, weekly">
                            </div>
                            <div class="form-group">
                                <label for="drugCurrentRoute">Route of administration</label>
                                <input type="text" id="drugCurrentRoute" placeholder="e.g., oral, inhaled, IV">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Have you used illicit drugs in the past?</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="drugPriorYes" name="drugPrior" value="yes" onchange="toggleConditional('drugPriorFields', true)">
                                <label for="drugPriorYes" style="margin: 0;">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="drugPriorNo" name="drugPrior" value="no" onchange="toggleConditional('drugPriorFields', false)">
                                <label for="drugPriorNo" style="margin: 0;">No</label>
                            </div>
                        </div>
                        <div id="drugPriorFields" class="conditional-fields">
                            <div class="form-group">
                                <label for="drugPriorType">Specify drug(s)</label>
                                <input type="text" id="drugPriorType" placeholder="e.g., marijuana, cocaine">
                            </div>
                            <div class="form-group">
                                <label for="drugPriorDuration">Duration</label>
                                <input type="text" id="drugPriorDuration" placeholder="e.g., 5 years, stopped 2010">
                            </div>
                            <div class="form-group">
                                <label for="drugPriorRoute">Route of administration</label>
                                <input type="text" id="drugPriorRoute" placeholder="e.g., oral, inhaled, IV">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- STOP-BANG -->
                <div class="section">
                    <h2 class="section-title">STOP-BANG Questionnaire (Sleep Apnea Screening)</h2>
                    <p class="info-text" style="margin-bottom: 15px;">Please answer the following questions:</p>
                    <div class="checkbox-group">
                        <div class="checkbox-option">
                            <input type="checkbox" id="sb1" name="stopbang" value="Snoring">
                            <label for="sb1" style="margin: 0;">Do you snore loudly (louder than talking or loud enough to be heard through closed doors)?</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="sb2" name="stopbang" value="Tired">
                            <label for="sb2" style="margin: 0;">Do you often feel tired, fatigued, or sleepy during the daytime?</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="sb3" name="stopbang" value="Observed">
                            <label for="sb3" style="margin: 0;">Has anyone observed you stop breathing during your sleep?</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="sb4" name="stopbang" value="Pressure">
                            <label for="sb4" style="margin: 0;">Do you have or are you being treated for high blood pressure?</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="sb5" name="stopbang" value="BMI">
                            <label for="sb5" style="margin: 0;">Is your BMI greater than 35 kg/m²?</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="sb6" name="stopbang" value="Age">
                            <label for="sb6" style="margin: 0;">Are you over 50 years old?</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="sb7" name="stopbang" value="Neck">
                            <label for="sb7" style="margin: 0;">Is your neck circumference greater than 40 cm (about 16 inches)?</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="sb8" name="stopbang" value="Male">
                            <label for="sb8" style="margin: 0;">Are you male?</label>
                        </div>
                    </div>
                </div>

                <!-- Questions for Visit -->
                <div class="section">
                    <h2 class="section-title">Questions for Your Visit</h2>
                    <div class="form-group">
                        <label for="patientQuestions">What are the most important questions you want answered during your visit?</label>
                        <textarea id="patientQuestions" rows="6" placeholder="Please list your questions here..."></textarea>
                    </div>
                </div>

                <!-- Submit -->
                <div class="submit-section">
                    <button type="button" class="btn btn-primary" onclick="generateSummary()">Generate Summary</button>
                </div>
            </form>

            <!-- Results -->
            <div id="resultContainer" class="result-container">
                <h3 class="result-title">Your Questionnaire Summary</h3>
                <div id="resultContent" class="result-content"></div>
                <div class="result-actions">
                    <button class="btn btn-primary" onclick="copyToClipboard()">Copy to Clipboard</button>
                    <button class="btn btn-secondary" onclick="downloadPDF()">Download as PDF</button>
                    <button class="btn btn-secondary" onclick="resetForm()">Fill Out Again</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        function addMedication() {
            const container = document.getElementById('medicationsContainer');
            const newEntry = document.createElement('div');
            newEntry.className = 'medication-entry';
            newEntry.innerHTML = `
                <div class="medication-input">
                    <input type="text" class="med-name" placeholder="Medication name">
                    <input type="text" class="med-dose" placeholder="Dose">
                </div>
                <button type="button" class="btn btn-remove" onclick="this.parentElement.remove()">Remove</button>
            `;
            container.appendChild(newEntry);
        }

        function toggleConditional(fieldId, show) {
            const field = document.getElementById(fieldId);
            if (show) {
                field.classList.add('active');
            } else {
                field.classList.remove('active');
            }
        }

        function calculatePackYears() {
            const years = parseFloat(document.getElementById('tobaccoPriorYears').value) || 0;
            const packs = parseFloat(document.getElementById('tobaccoPriorPacks').value) || 0;
            const packYears = years * packs;

            const display = document.getElementById('packYearsDisplay');
            if (packYears > 0) {
                display.style.display = 'block';
                display.textContent = `Pack-Years: ${packYears.toFixed(1)}`;
            } else {
                display.style.display = 'none';
            }
        }

        function generateSummary() {
            let summary = '';

            // Primary Care
            const pcp = document.getElementById('pcpName').value.trim();
            summary += `Primary Care: ${pcp || 'Not provided'}\n`;

            // Medications
            const medEntries = document.querySelectorAll('.medication-entry');
            const meds = [];
            medEntries.forEach(entry => {
                const name = entry.querySelector('.med-name').value.trim();
                const dose = entry.querySelector('.med-dose').value.trim();
                if (name && dose) {
                    meds.push(`${name} ${dose}`);
                } else if (name) {
                    meds.push(name);
                }
            });
            summary += `Medications/Supplements: ${meds.length > 0 ? meds.join(', ') : 'None reported'}\n`;

            // Blood Pressure
            const bpSysMin = document.getElementById('bpSystolicMin').value;
            const bpSysMax = document.getElementById('bpSystolicMax').value;
            const bpDiaMin = document.getElementById('bpDiastolicMin').value;
            const bpDiaMax = document.getElementById('bpDiastolicMax').value;

            if (bpSysMin && bpSysMax && bpDiaMin && bpDiaMax) {
                summary += `Home BP (past week): ${bpSysMin}–${bpSysMax} / ${bpDiaMin}–${bpDiaMax} mmHg\n`;
            } else if (bpSysMin && bpDiaMin) {
                summary += `Home BP (past week): ${bpSysMin} / ${bpDiaMin} mmHg\n`;
            } else {
                summary += `Home BP (past week): Not provided\n`;
            }

            // Tobacco
            const tobaccoCurrent = document.querySelector('input[name="tobaccoCurrent"]:checked')?.value;
            const tobaccoPrior = document.querySelector('input[name="tobaccoPrior"]:checked')?.value;

            if (tobaccoCurrent === 'yes') {
                const type = document.getElementById('tobaccoType').value.trim();
                const amount = document.getElementById('tobaccoAmount').value.trim();
                summary += `Tobacco: current user, ${type}${amount ? ', ' + amount : ''}\n`;
            } else if (tobaccoPrior === 'yes') {
                const years = document.getElementById('tobaccoPriorYears').value;
                const packs = document.getElementById('tobaccoPriorPacks').value;
                const packYears = years && packs ? (parseFloat(years) * parseFloat(packs)).toFixed(1) : null;
                summary += `Tobacco: former user${packYears ? ', ' + packYears + ' pack-years' : ''}\n`;
            } else {
                summary += `Tobacco: never used\n`;
            }

            // Alcohol
            const alcoholCurrent = document.querySelector('input[name="alcoholCurrent"]:checked')?.value;
            const alcoholPrior = document.querySelector('input[name="alcoholPrior"]:checked')?.value;

            if (alcoholCurrent === 'yes') {
                const type = document.getElementById('alcoholType').value.trim();
                const drinks = document.getElementById('alcoholDrinks').value;
                const years = document.getElementById('alcoholYears').value;
                summary += `Alcohol: current${type ? ', ' + type : ''}${drinks ? ', ' + drinks + ' drinks/week' : ''}${years ? ', ' + years + ' years' : ''}\n`;
            } else if (alcoholPrior === 'yes') {
                const type = document.getElementById('alcoholPriorType').value.trim();
                const duration = document.getElementById('alcoholPriorDuration').value.trim();
                summary += `Alcohol: former user${type ? ', ' + type : ''}${duration ? ', ' + duration : ''}\n`;
            } else {
                summary += `Alcohol: none\n`;
            }

            // Illicit Drugs
            const drugCurrent = document.querySelector('input[name="drugCurrent"]:checked')?.value;
            const drugPrior = document.querySelector('input[name="drugPrior"]:checked')?.value;

            if (drugCurrent === 'yes') {
                const type = document.getElementById('drugCurrentType').value.trim();
                const freq = document.getElementById('drugCurrentFreq').value.trim();
                const route = document.getElementById('drugCurrentRoute').value.trim();
                summary += `Illicit drugs: current${type ? ', ' + type : ''}${freq ? ', ' + freq : ''}${route ? ', ' + route : ''}\n`;
            } else if (drugPrior === 'yes') {
                const type = document.getElementById('drugPriorType').value.trim();
                const duration = document.getElementById('drugPriorDuration').value.trim();
                const route = document.getElementById('drugPriorRoute').value.trim();
                summary += `Illicit drugs: former user${type ? ', ' + type : ''}${duration ? ', ' + duration : ''}${route ? ', ' + route : ''}\n`;
            } else {
                summary += `Illicit drugs: none\n`;
            }

            // STOP-BANG
            const stopbangChecked = document.querySelectorAll('input[name="stopbang"]:checked');
            const stopbangItems = Array.from(stopbangChecked).map(cb => cb.value);
            const stopbangScore = stopbangItems.length;
            summary += `STOP-BANG: ${stopbangScore}/8`;
            if (stopbangScore > 0) {
                summary += ` (Yes: ${stopbangItems.join(', ')})`;
            }
            summary += `\n`;

            // Patient Questions
            const questions = document.getElementById('patientQuestions').value.trim();
            if (questions) {
                summary += `\nPatient Questions:\n${questions}`;
            } else {
                summary += `\nPatient Questions: None provided`;
            }

            // Display result
            document.getElementById('resultContent').textContent = summary;
            document.getElementById('resultContainer').classList.add('active');
            document.getElementById('resultContainer').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function copyToClipboard() {
            const content = document.getElementById('resultContent').textContent;
            navigator.clipboard.writeText(content).then(() => {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = 'Copied!';
                btn.style.background = '#28a745';
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '';
                }, 2000);
            }).catch(err => {
                alert('Failed to copy to clipboard. Please copy manually.');
            });
        }

        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Header
            doc.setFontSize(16);
            doc.setTextColor(75, 46, 131);
            doc.text('Pre-Visit Questionnaire', 20, 20);
            doc.setFontSize(12);
            doc.text('UW Medicine / Harborview Medical Center - Stroke Clinic', 20, 28);

            // Content
            doc.setFontSize(10);
            doc.setTextColor(0, 0, 0);
            const content = document.getElementById('resultContent').textContent;
            const lines = doc.splitTextToSize(content, 170);
            doc.text(lines, 20, 40);

            // Footer
            const date = new Date().toLocaleDateString();
            doc.setFontSize(8);
            doc.setTextColor(100, 100, 100);
            doc.text(`Generated: ${date}`, 20, 280);

            doc.save('pre-visit-questionnaire.pdf');
        }

        function resetForm() {
            document.getElementById('questionnaireForm').reset();
            document.getElementById('resultContainer').classList.remove('active');
            document.querySelectorAll('.conditional-fields').forEach(field => {
                field.classList.remove('active');
            });
            document.getElementById('packYearsDisplay').style.display = 'none';

            // Remove extra medication entries
            const container = document.getElementById('medicationsContainer');
            const entries = container.querySelectorAll('.medication-entry');
            for (let i = 1; i < entries.length; i++) {
                entries[i].remove();
            }

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>